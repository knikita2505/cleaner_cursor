# [SCREEN] photos_duplicates

## Назначение
Экран для поиска и удаления **точных и сильно похожих дубликатов фотографий**. Основной источник очищаемого объёма.

---

## Структура UI

### 1. Header
- Заголовок: `Duplicate photos`
- Кнопка Back → возвращает на `main_dashboard`.
- Справа — кнопка `Select All` / `Deselect All` (меняется в зависимости от состояния).

### 2. Summary Bar
Под хедером узкая панель:
- `Groups: <N>`
- `Potential savings: <X.Y> GB`

### 3. Список групп дубликатов
Скроллируемый список, каждая группа — секция:

**Группа:**
- Горизонтальный скролл превью 3–6 фото (stacked).
- Индикатор размера: `<N> photos • <M MB>`
- Small label: `Auto-selected: X`

По умолчанию:
- В каждой группе ОДНО фото помечено как «оставить», остальные — «удалить».

Тап по группе → раскрытие:

**В раскрытии:**
- Все фото сеткой 3 в ряд.
- На каждом:
  - чекбокс (`Delete`) или бейдж `Keep`.
  - Тап по фото:
    - если сейчас `Delete` → можно переключить на `Keep`;
    - всегда должен оставаться минимум 1 `Keep` в группе.

### 4. Bottom Bar (CTA)
Фиксированная панель:
- Текст: `<K> photos selected • <Y MB> to clean`
- Кнопка `Delete selected`

При отсутствии выбранных: кнопка disabled.

---

## Логика

### Алгоритм группировки (высокоуровнево)
- Анализ по:
  - хэшам изображений,
  - дате/времени съёмки,
  - разрешению и размеру.
- Группы формируются, если:
  - хэши совпадают или очень похожи;
  - разница по времени сделана < N секунд;
  - размер отличается незначительно.

### Auto-selection
- По умолчанию:
  - сохраняем самую качественную/самую позднюю фотографию (больше разрешение, меньше шум, нет blur).
  - остальные отмечаем как `Delete`.
- Пользователь может изменить выбор.

### Удаление
- При нажатии `Delete selected`:
  - показ модального подтверждения:  
    `Are you sure you want to delete N photos? This action cannot be undone.`
  - после подтверждения:
    - удаляем через API Photos;
    - обновляем кэш;
    - обновляем `main_dashboard` и историю (`cleaning_history`).

### Free-limit
- Если free-лимит достигнут:
  - до удаления показываем `paywall_main` с текстом про лимит;
  - без Premium реальные удаления не выполняем.

---

## Edge cases
- Нет найденных дубликатов:
  - показать иллюстрацию и текст: `No duplicate photos found`.
  - CTA: `Go back to Dashboard`.

---

## Аналитика
- `dup_photos_open`
- `dup_group_expand`
- `dup_photo_keep_change`
- `dup_delete_confirm`
- `dup_delete_success` (N photos, size)
