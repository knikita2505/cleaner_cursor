## NOTIF-001 — Push Notifications Implementation

### Назначение
Реализовать полноценную систему пуш-уведомлений для повышения удержания, возврата пользователей, напоминаний о чистке и триггерных сценариев (free limit reached, highlights ready и т.п.).

---

### Функциональные требования

1. **Запрос разрешений**
   - Запросить уведомления только после:
     - онбординга,
     - или при первом запуске Dashboard.
   - Обрабатывать:
     - разрешено,
     - отказано,
     - пользователь отключил в настройках.
   - Логировать:
     - `notif_request`,
     - `notif_granted`,
     - `notif_denied`.

2. **Генерация пушей внутри приложения**
   Пуши локальные. Сервер не нужен.

   Типы сообщений:
   - `daily_clean_reminder` — раз в день, если пользователь не чистил фото >24 часов.
   - `limit_reached_reminder` — если пользователь достиг free-лимита и не купил подписку.
   - `storage_high_90` — если заполненность >90%.
   - `come_back_swipe_clean` — если пользователь начал swipe session, но не завершил.
   - `highlight_ready` — раз в неделю: «У нас новые лучшие фото для вас».

   Важные требования:
   - Пуши должны отправляться только если разрешены уведомления.
   - Не спамить (не более 1 пуша в сутки).

3. **Планирование пушей**
   - Планирование через UNUserNotificationCenter.
   - Использовать календарные триггеры (например, каждый день в 20:00).
   - Хранить статусы, чтобы не отправлять дубли.

4. **Точечные пуши по событиям**
   - При достижении free-лимита:
     - отправить уведомление через 30–60 минут:
       - «Вы достигли лимита. Разблокируйте полный доступ».
   - После анализа хранилища, если storage >85%:
     - «iPhone почти заполнен. Очистите дубликаты сейчас.»

5. **Интеграция с Firebase analytics**
   Логировать триггеры отправки и открытия пушей:
   - `notif_scheduled`
   - `notif_fired`
   - `notif_opened`
   - `notif_type_{id}`

6. **Обработка ошибок**
   - Ошибка планирования → логировать `notif_error_schedule`
   - Если notification permissions revoked → не пытаться отправить
   - Если устройство в DND → пуш не считается доставленным (не логировать opened)

---

### Acceptance Criteria
- Все типы пушей планируются корректно.
- Пуши приходят только с разрешением пользователя.
- Не более 1 пуша за сутки.
- При тапе по пушу открывается правильный экран:
  - Clean Reminder → Dashboard  
  - Limit Reached → Paywall  
  - Storage High → storage_overview  
  - Highlights → photos_highlights  

---

### Связанные задачи
- SETTINGS-002 (toggle уведомлений)
- STORAGE-001 (детекция high storage)
- PHOTO-HIGHLIGHTS-001 (еженедельный пуш)
- PAYWALL-LIMIT-001 (пуш после лимита)
